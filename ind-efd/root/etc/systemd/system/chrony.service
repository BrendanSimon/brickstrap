##
## Successful Endeavours
##
## There is no `systemd` service file for `chrony` in Deiban Jessie.
## This file was taken from Debian Stretch sources.
## The `Restart=always` stanza was added to keep restart the service if it
## exits (e.g. if `adjtimex()` fails.  See BitBucket issue #118).
##

[Unit]
Description=chrony, an NTP client/server
Documentation=man:chronyd(8) man:chronyc(1) man:chrony.conf(5)
Conflicts=systemd-timesyncd.service openntpd.service
After=network.target
ConditionCapability=CAP_SYS_TIME

[Service]
Type=forking
PIDFile=/run/chronyd.pid
## chrony has trouble syncing times that are too old, so reset to year 2000.
ExecStartPre=/bin/bash -c '/usr/bin/test $(date +"%Y") -lt 2000 && date --set="2000-01-01 00:00:00" || true'
ExecStart=/usr/sbin/chronyd
## kill gpsd after chrony has started to force restart.
## assumes gpsd has been configured to always restart !!
ExecStartPost=-/usr/bin/killall -TERM gpsd
PrivateTmp=yes
ProtectHome=yes
ProtectSystem=full
Restart=always

[Install]
Alias=chronyd.service
WantedBy=multi-user.target
